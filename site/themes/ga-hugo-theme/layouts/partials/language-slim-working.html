<!-- https://discourse.gohugo.io/t/live-reload-not-working-again-how-can-i-fix/18436/4 -->
<form id="preferenceLang" action="" method="" ><!-- onsubmit="return preventSubmit(event);" -->
  <label class="dn" for="inputLang">Language:</label>
  <select
  class="f3"
  id="inputLang" name=language>
    <!--option data-italiano||data-english disabled selected>Opzioni&hellip;||Preference&hellip;</option-->
    <option data-english value="en">English</option>
    <option data-italiano value="it">Italiano</option><!-- selected="selected" -->
  </select>
</form>
<script type="text/javascript">

  // https://stackoverflow.com/questions/7562095/redirect-on-select-option-in-select-box
  // this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value)
  const inputLang = document.querySelector('#inputLang')
  // When a new <option> is selected
  function forwardTo(thisLang) {
    if (thisLang != '') {
      let href = window.location.href;
      alert('0). ' + thisLang)
      window.location.assign('/' + thisLang)
    }
  };

  inputLang.addEventListener('change', function () {
    //`var index = inputLang.selectedIndex;` //returns: 0=en, 1=it
    //`alert('hello: ' + index);` //returns user input
    
    var thisLang = this.value;
    forwardTo(thisLang);
    alert('1). Is this working? can you record: ' + thisLang)
    localStorage.setItem('inputLang', inputLang.options[inputLang.selectedIndex].value);
    //`inputLang = inputLang.options[inputLang.selectedIndex].value;` //MISSING?
  });//forwardTo(); Forward to this language page

  // stackoverflow.com/questions/23905358/how-to-use-localstorage-on-last-html-select-value
  // const inputLang = document.querySelector('#inputLang')
  // UI helper?
  
  
  
  





function indexPrefLang() {
  var value = localStorage.getItem('inputLang');
  alert("2). what's in `localStorgage`? " + value)
  let href = window.location.href.substr(-3, 2);
  alert('3). what is the URL bar saying with `.substr(-3, 2)`? ' + href)
  
  
  if (href != value) {
    window.location.assign('/' + value)    
  } else { 
    return false;
  }
}  

  // stackoverflow.com/questions/27664654/html-how-to-fill-input-text-on-load
  // initialise UI helper	
  function defaultLang() {
    // Initial condition, from browser
    var fromNavigator = navigator.language.toLowerCase().substr(0, 2) || navigator.userLanguage.toLowerCase().substr(0, 2);
    // Store defaultLang fromNavigator
    localStorage.setItem('inputLang', fromNavigator);
  };//defaultLang(); from interrogating browser

    // A Crockford iife: https://stackoverflow.com/a/23925102/3429622
    (function () {
      // Select option initial condition for 'inputLang':	
      var value = localStorage.getItem('inputLang');
      if (value >= 1) {
        // make it correct [selectedIndex].value
        localStorage.setItem('inputLang', inputLang.options[inputLang.selectedIndex].value);
      } else if (value == -1 || value === null || value === undefined) {
        // initialise default
        defaultLang()
      }
      alert('4). initial ' + value)      
      indexPrefLang();
      //window.location.assign('/' + preferedLang)
      
alert('5). THIS: inputLang.options[inputLang.selectedIndex].value is = '
  + inputLang.options[inputLang.selectedIndex].value);//en
alert('6). AND THIS: inputLang.selectedIndex is = '
  + inputLang.selectedIndex);//0

      //THIS IS THE ONE MISSING: localStorage.getItem('inputLang', inputLang.options[inputLang.selectedIndex].value);
      

    }());// stackoverflow.com/questions/27664654/html-how-to-fill-input-text-on-load
</script>